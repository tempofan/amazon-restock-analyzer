# ğŸš€ äº‘æœåŠ¡å™¨é‡æ–°éƒ¨ç½²æŒ‡å—

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹å‡ºï¼š
- âœ… äº‘æœåŠ¡å™¨æ”¶åˆ°54ä¸ªé£ä¹¦è¯·æ±‚
- âŒ 53ä¸ªè¯·æ±‚å¤±è´¥
- âŒ è½¬å‘æ—¶æ•°æ®ä¸¢å¤±  
- âŒ ç›´æ¥å¤„ç†ä¹Ÿè¶…æ—¶

**æ ¹æœ¬åŸå› **ï¼šäº‘æœåŠ¡å™¨ä¸Šçš„ä»£ç å­˜åœ¨ä¸¥é‡ç¼ºé™·ï¼Œæ— æ³•æ­£ç¡®å¤„ç†é£ä¹¦è¯·æ±‚ã€‚

## ğŸ¯ è§£å†³æ–¹æ¡ˆ

**å®Œå…¨é‡æ–°éƒ¨ç½²äº‘æœåŠ¡å™¨**ï¼Œä½¿ç”¨æ–°çš„ã€ç»è¿‡æµ‹è¯•çš„ä»£ç æ›¿æ¢ç°æœ‰çš„æœ‰ç¼ºé™·ä»£ç ã€‚

## ğŸ”§ éƒ¨ç½²æ–¹æ¡ˆç‰¹ç‚¹

### âœ… æ–°æ¶æ„ä¼˜åŠ¿
1. **ç›´æ¥å¤„ç†** - äº‘æœåŠ¡å™¨ç›´æ¥å¤„ç†é£ä¹¦è¯·æ±‚ï¼Œä¸å†è½¬å‘
2. **ç®€åŒ–æ¶æ„** - å‡å°‘ç½‘ç»œä¼ è¾“ç¯èŠ‚ï¼Œæé«˜å¯é æ€§
3. **å®Œæ•´åŠŸèƒ½** - æ”¯æŒæ‰€æœ‰é£ä¹¦æœºå™¨äººå‘½ä»¤
4. **å¥å£®è®¾è®¡** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
5. **æ˜“äºç»´æŠ¤** - æ ‡å‡†åŒ–çš„systemdæœåŠ¡ç®¡ç†

### ğŸ—ï¸ æ–°æ¶æ„æµç¨‹
```
é£ä¹¦å¼€æ”¾å¹³å° â†’ äº‘æœåŠ¡å™¨(ç›´æ¥å¤„ç†) â†’ é¢†æ˜ŸAPI
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

### æ–¹æ³•1: è‡ªåŠ¨åŒ–éƒ¨ç½² (æ¨è)

åœ¨Windowsæœ¬åœ°æ‰§è¡Œï¼š

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd äºšé©¬é€Šè¡¥è´§

# 2. æ‰§è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²
python deploy/upload_and_redeploy.py
```

### æ–¹æ³•2: æ‰‹åŠ¨éƒ¨ç½²

#### æ­¥éª¤1: ä¸Šä¼ æ–‡ä»¶åˆ°äº‘æœåŠ¡å™¨

```bash
# ä¸Šä¼ æ–°ä»£ç 
scp deploy/cloud_server_redeploy.py ubuntu@175.178.183.96:/tmp/
scp deploy/redeploy_cloud_server.sh ubuntu@175.178.183.96:/tmp/
```

#### æ­¥éª¤2: åœ¨äº‘æœåŠ¡å™¨ä¸Šæ‰§è¡Œéƒ¨ç½²

```bash
# è¿æ¥åˆ°äº‘æœåŠ¡å™¨
ssh ubuntu@175.178.183.96

# æ‰§è¡Œéƒ¨ç½²è„šæœ¬
cd /tmp
chmod +x redeploy_cloud_server.sh
sudo ./redeploy_cloud_server.sh
```

## âš™ï¸ éƒ¨ç½²åé…ç½®

### 1. é…ç½®é£ä¹¦åº”ç”¨ä¿¡æ¯

åœ¨äº‘æœåŠ¡å™¨ä¸Šç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

```bash
sudo nano /opt/feishu-cloud-server/.env
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```env
# é£ä¹¦åº”ç”¨é…ç½®
FEISHU_APP_ID=cli_ä½ çš„å®é™…app_id
FEISHU_APP_SECRET=ä½ çš„å®é™…app_secret
FEISHU_VERIFICATION_TOKEN=ä½ çš„å®é™…verification_token

# é¢†æ˜ŸAPIé…ç½®ï¼ˆå¯é€‰ï¼‰
LINGXING_APP_ID=ä½ çš„é¢†æ˜Ÿapp_id
LINGXING_APP_SECRET=ä½ çš„é¢†æ˜Ÿapp_secret
```

### 2. é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ

```bash
sudo systemctl restart feishu-cloud-server
```

### 3. éªŒè¯æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status feishu-cloud-server

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo journalctl -u feishu-cloud-server -f

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8080/health
```

## ğŸ”— é£ä¹¦å¼€æ”¾å¹³å°é…ç½®

### 1. æ›´æ–°Webhook URL

åœ¨é£ä¹¦å¼€æ”¾å¹³å°ä¸­ï¼Œå°†äº‹ä»¶è®¢é˜…çš„è¯·æ±‚URLæ›´æ–°ä¸ºï¼š

```
http://175.178.183.96:8080/feishu/webhook
```

### 2. éªŒè¯URL

ç‚¹å‡»"éªŒè¯"æŒ‰é’®ï¼Œç¡®ä¿æ˜¾ç¤º"éªŒè¯æˆåŠŸ"ã€‚

### 3. ç¡®è®¤äº‹ä»¶è®¢é˜…

ç¡®ä¿ä»¥ä¸‹äº‹ä»¶å·²æ·»åŠ ï¼š
- `im.message.receive_v1` - æ¥æ”¶æ¶ˆæ¯
- `im.chat.member.bot.added_v1` - æœºå™¨äººåŠ å…¥ç¾¤èŠ

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://175.178.183.96:8080/health

# æµ‹è¯•ç»Ÿè®¡ä¿¡æ¯
curl http://175.178.183.96:8080/stats

# æµ‹è¯•é…ç½®çŠ¶æ€
curl http://175.178.183.96:8080/test
```

### 2. é£ä¹¦æœºå™¨äººæµ‹è¯•

åœ¨é£ä¹¦ç¾¤èŠä¸­å‘é€ï¼š

```
@æœºå™¨äºº å¸®åŠ©
@æœºå™¨äºº æµ‹è¯•
@æœºå™¨äºº çŠ¶æ€
```

## ğŸ“Š æœåŠ¡ç®¡ç†

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status feishu-cloud-server

# å¯åŠ¨æœåŠ¡
sudo systemctl start feishu-cloud-server

# åœæ­¢æœåŠ¡
sudo systemctl stop feishu-cloud-server

# é‡å¯æœåŠ¡
sudo systemctl restart feishu-cloud-server

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u feishu-cloud-server -f

# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
sudo journalctl -u feishu-cloud-server -n 50
```

### æ—¥å¿—æ–‡ä»¶ä½ç½®

- ç³»ç»Ÿæ—¥å¿—: `journalctl -u feishu-cloud-server`
- åº”ç”¨æ—¥å¿—: `/var/log/feishu_cloud_server.log`

## ğŸ” æ•…éšœæ’é™¤

### 1. æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
sudo journalctl -u feishu-cloud-server -n 20

# æ£€æŸ¥é…ç½®æ–‡ä»¶
sudo cat /opt/feishu-cloud-server/.env

# æ‰‹åŠ¨æµ‹è¯•å¯åŠ¨
cd /opt/feishu-cloud-server
sudo -u ubuntu python3 server.py
```

### 2. é£ä¹¦æ¶ˆæ¯æ— å“åº”

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u feishu-cloud-server -f

# æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I http://175.178.183.96:8080/health

# æµ‹è¯•Webhookæ¥å£
curl -X POST http://175.178.183.96:8080/feishu/webhook \
  -H "Content-Type: application/json" \
  -d '{"type":"url_verification","challenge":"test"}'
```

### 3. é…ç½®é—®é¢˜

```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
sudo systemctl show feishu-cloud-server --property=Environment

# éªŒè¯é…ç½®æ–‡ä»¶æ ¼å¼
sudo cat /opt/feishu-cloud-server/.env | grep -v '^#' | grep '='
```

## ğŸ¯ é¢„æœŸç»“æœ

éƒ¨ç½²æˆåŠŸåï¼Œåº”è¯¥å®ç°ï¼š

1. âœ… äº‘æœåŠ¡å™¨ç›´æ¥å¤„ç†é£ä¹¦è¯·æ±‚
2. âœ… é£ä¹¦æœºå™¨äººæ­£å¸¸å“åº”ç”¨æˆ·æ¶ˆæ¯
3. âœ… æ”¯æŒæ‰€æœ‰åŸºç¡€å‘½ä»¤ï¼ˆå¸®åŠ©ã€æµ‹è¯•ã€çŠ¶æ€ç­‰ï¼‰
4. âœ… å®Œå–„çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†
5. âœ… ç¨³å®šçš„æœåŠ¡è¿è¡Œ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**: `sudo journalctl -u feishu-cloud-server -f`
2. **æ£€æŸ¥é…ç½®**: ç¡®ä¿ `.env` æ–‡ä»¶é…ç½®æ­£ç¡®
3. **ç½‘ç»œæµ‹è¯•**: ç¡®ä¿ç«¯å£8080å¯è®¿é—®
4. **é‡å¯æœåŠ¡**: `sudo systemctl restart feishu-cloud-server`

## ğŸ‰ æˆåŠŸæ ‡å¿—

å½“çœ‹åˆ°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼š

- âœ… æœåŠ¡çŠ¶æ€æ˜¾ç¤º `active (running)`
- âœ… å¥åº·æ£€æŸ¥æ¥å£è¿”å›æ­£å¸¸å“åº”
- âœ… é£ä¹¦ç¾¤èŠä¸­@æœºå™¨äººæœ‰å“åº”
- âœ… æ—¥å¿—ä¸­æ˜¾ç¤ºæ­£å¸¸å¤„ç†æ¶ˆæ¯

---

ğŸ’¡ **é‡è¦æé†’**: è¿™ä¸ªæ–°çš„éƒ¨ç½²æ–¹æ¡ˆå®Œå…¨æ›¿æ¢äº†åŸæœ‰çš„æœ‰ç¼ºé™·ä»£ç ï¼Œåº”è¯¥èƒ½å¤Ÿè§£å†³"53ä¸ªè¯·æ±‚å¤±è´¥"çš„é—®é¢˜ã€‚
